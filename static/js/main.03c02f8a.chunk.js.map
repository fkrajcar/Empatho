{"version":3,"sources":["constants/index.js","App.jsx","index.js"],"names":["module","exports","WEBCAM_HEIGHT","WEBCAM_WIDTH","EXPRESSION_DETECTION_INTERVAL_MS","TIMER_INTERVAL_MS","EXPRESSIONS_ANGRY","EXPRESSIONS_HAPPY","EXPRESSIONS_NEUTRAL","EXPRESSIONS_SAD","EXPRESSIONS_SURPRISED","EXPRESSIONS","this","VIDEO_CONSTRAINTS","width","height","facingMode","MODEL_URL","process","IMAGES_URL","App","props","getFullFaceDescription","pictureSrc","a","faceapi","image","withFaceExpressions","undefined","detections","console","log","expressions","detectedExpression","Object","keys","reduce","b","setState","isDetected","loadModels","gameLogicStart","state","gameTimerIntervalID","correctEmotionTimerIntervalID","gameCorrectEmotionTimer","gameTimer","gameScore","randomExpression","setInterval","gameLogicStop","generateRandomExpression","sample","clearInterval","hasStarted","startGame","startingTimer","intervalID","startCapturing","imageSrc","webcam","current","getScreenshot","fullFaceDescriptions","canvas","React","createRef","canvasPicWebCam","isLoading","then","prevProps","prevState","snapshot","Container","className","audio","ref","screenshotFormat","videoConstraints","style","display","Image","src","Button","variant","onClick","Component","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.03c02f8a.chunk.js","sourcesContent":["module.exports.WEBCAM_HEIGHT = 480;\nmodule.exports.WEBCAM_WIDTH = 480;\nmodule.exports.EXPRESSION_DETECTION_INTERVAL_MS = 250;\nmodule.exports.TIMER_INTERVAL_MS = 1000;\nmodule.exports.EXPRESSIONS_ANGRY = 'angry';\nmodule.exports.EXPRESSIONS_HAPPY = 'happy';\nmodule.exports.EXPRESSIONS_NEUTRAL = 'neutral';\nmodule.exports.EXPRESSIONS_SAD = 'sad';\nmodule.exports.EXPRESSIONS_SURPRISED = 'surprised';\nmodule.exports.EXPRESSIONS = [this.EXPRESSIONS_ANGRY, this.EXPRESSIONS_HAPPY, this.EXPRESSIONS_NEUTRAL, this.EXPRESSIONS_SAD, this.EXPRESSIONS_SURPRISED];\n\nmodule.exports.VIDEO_CONSTRAINTS = {\n  width: this.WEBCAM_WIDTH,\n  height: this.WEBCAM_HEIGHT,\n  facingMode: 'user',\n};\n\nmodule.exports.MODEL_URL = `${process.env.PUBLIC_URL}/models`;\nmodule.exports.IMAGES_URL = `${process.env.PUBLIC_URL}/img/`;\n","import React, { Component } from 'react';\nimport * as faceapi from 'face-api.js';\nimport Container from 'react-bootstrap/Container';\nimport Image from 'react-bootstrap/Image';\nimport Webcam from 'react-webcam';\nimport Button from 'react-bootstrap/Button';\nimport sample from 'lodash/sample';\n\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport './App.css';\n\nimport {\n  EXPRESSION_DETECTION_INTERVAL_MS,\n  MODEL_URL,\n  WEBCAM_HEIGHT,\n  WEBCAM_WIDTH,\n  VIDEO_CONSTRAINTS,\n  TIMER_INTERVAL_MS,\n  IMAGES_URL,\n  EXPRESSIONS,\n} from './constants';\n\nexport default class App extends Component {\n  constructor(props) {\n    super(props);\n    this.fullFaceDescriptions = null;\n    this.canvas = React.createRef();\n    this.canvasPicWebCam = React.createRef();\n    this.webcam = React.createRef();\n\n    this.state = {\n      isLoading: true,\n      isDetected: false,\n      hasStarted: false,\n      detectedExpression: 'neutral',\n      randomExpression: sample(EXPRESSIONS),\n      startingTimer: 3,\n      intervalID: null,\n      gameTimerIntervalID: null,\n      correctEmotionTimerIntervalID: null,\n      gameCorrectEmotionTimer: 5,\n      gameTimer: 60,\n      gameScore: 0,\n    };\n  }\n\n  async componentDidMount() {\n    this.loadModels().then(() => {\n      this.startCapturing();\n    });\n  }\n\n  componentDidUpdate(prevProps, prevState, snapshot) {\n    const { hasStarted, startingTimer } = this.state;\n  }\n\n    getFullFaceDescription = async (pictureSrc) => {\n      const image = await faceapi.fetchImage(pictureSrc);\n\n      const detections = await faceapi.detectSingleFace(image, new faceapi.TinyFaceDetectorOptions()).withFaceExpressions();\n\n      if (detections !== undefined) {\n        console.log(detections.expressions);\n\n        const detectedExpression = Object.keys(detections.expressions).reduce((a, b) => (detections.expressions[a] > detections.expressions[b] ? a : b));\n\n        this.setState({\n          isDetected: true,\n          detectedExpression,\n        });\n      } else {\n        this.setState({\n          isDetected: false,\n        });\n      }\n    };\n\n    loadModels = async () => {\n      await faceapi.loadTinyFaceDetectorModel(MODEL_URL);\n      await faceapi.loadFaceExpressionModel(MODEL_URL);\n    };\n\n    gameLogicStart = () => {\n      let { gameTimerIntervalID,\n        correctEmotionTimerIntervalID,\n        gameCorrectEmotionTimer,\n        gameScore,\n        gameTimer,\n        randomExpression,\n      } = this.state;\n\n      this.setState(\n        { gameScore: 0 },\n      );\n\n      correctEmotionTimerIntervalID = setInterval(() => {\n        if (gameCorrectEmotionTimer === 0) {\n          this.setState({\n            gameCorrectEmotionTimer: 5,\n          });\n        } else {\n          gameCorrectEmotionTimer -= 1;\n          console.log(gameCorrectEmotionTimer);\n          this.setState(\n            { gameCorrectEmotionTimer },\n          );\n        }\n      }, TIMER_INTERVAL_MS);\n\n      gameTimerIntervalID = setInterval(() => {\n        if (gameTimer === 0) {\n          this.gameLogicStop();\n        } else {\n          gameTimer -= 1;\n\n          if (gameTimer % 5 === 0) {\n            let generateRandomExpression = sample(EXPRESSIONS);\n\n            while (randomExpression === generateRandomExpression) {\n              generateRandomExpression = sample(EXPRESSIONS);\n            }\n\n            randomExpression = generateRandomExpression;\n          }\n\n          this.setState(\n            { gameTimer, randomExpression },\n          );\n        }\n      }, TIMER_INTERVAL_MS);\n\n      this.setState(\n        { gameTimerIntervalID, correctEmotionTimerIntervalID },\n      );\n    }\n\n  gameLogicStop = () => {\n    const { gameTimerIntervalID,\n      correctEmotionTimerIntervalID,\n      gameCorrectEmotionTimer,\n      gameScore,\n      gameTimer,\n    } = this.state;\n\n    clearInterval(gameTimerIntervalID);\n    clearInterval(correctEmotionTimerIntervalID);\n    this.setState(\n      {\n        gameTimer: 60,\n        hasStarted: false,\n      },\n    );\n  }\n\n  startGame = () => {\n    const { hasStarted } = this.state;\n    let { startingTimer, intervalID } = this.state;\n\n    if (hasStarted) {\n      this.gameLogicStop();\n      clearInterval(intervalID);\n      this.setState({\n        hasStarted: !hasStarted,\n        startingTimer: 3,\n      });\n    } else {\n      intervalID = setInterval(() => {\n        if (startingTimer === 0) {\n          this.gameLogicStart();\n          clearInterval(intervalID);\n        } else {\n          startingTimer -= 1;\n          this.setState({\n            startingTimer,\n          });\n        }\n      }, TIMER_INTERVAL_MS);\n      this.setState({\n        hasStarted: !hasStarted,\n        intervalID,\n      });\n    }\n  };\n\n    startCapturing = () => {\n      setInterval(() => {\n        const imageSrc = this.webcam.current.getScreenshot();\n\n        this.getFullFaceDescription(imageSrc);\n      }, EXPRESSION_DETECTION_INTERVAL_MS);\n    };\n\n    render() {\n      const { isDetected, detectedExpression, isLoading, hasStarted, startingTimer, randomExpression } = this.state;\n\n      return (\n        <Container>\n          <div className={hasStarted ? 'webcam-faces hasStarted' : 'webcam-faces'}>\n            <Webcam\n              className=\"webcam\"\n              audio={false}\n              width={WEBCAM_WIDTH}\n              height={WEBCAM_HEIGHT}\n              ref={this.webcam}\n              screenshotFormat=\"image/jpeg\"\n              videoConstraints={VIDEO_CONSTRAINTS}\n            />\n            <div\n              style={{ display: 'none' }}\n            >\n              <canvas ref={this.canvasPicWebCam} width={WEBCAM_WIDTH} height={WEBCAM_HEIGHT} />\n            </div>\n            <div className={hasStarted ? 'emoji-timer-container hasStarted' : 'emoji-timer-container'}>\n              {\n                hasStarted && startingTimer !== 0\n                  ? <p className=\"timer\">{startingTimer}</p>\n                  : <Image className={hasStarted ? 'emoji hasStarted' : 'emoji'} src={`${IMAGES_URL}${randomExpression}.png`} />\n               }\n            </div>\n          </div>\n          <div className=\"current_expression-container\">\n            <Image className=\"current_expression-emoji\" src={`${IMAGES_URL}${detectedExpression}.png`} />\n          </div>\n          <div className=\"controls\">\n            <Button\n              variant={hasStarted ? 'danger' : 'primary'}\n              onClick={this.startGame}\n            >\n              {\n                hasStarted\n                  ? 'Stop game'\n                  : 'Start game'\n              }\n            </Button>\n          </div>\n        </Container>\n      );\n    }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n"],"sourceRoot":""}